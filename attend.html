<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mark Attendance</title>
<style>
  body { font-family: Arial,sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); margin:0; display:flex; justify-content:center; padding:2rem; }
  .form-container { background:#fff; padding:25px; max-width:350px; border-radius:15px; box-shadow:0 0 15px rgba(0,0,0,0.2); width:100%; }
  h2 { text-align:center; margin-bottom:20px; }
  label { display:block; margin:1rem 0 0.3rem 0; font-weight:bold; }
  input[type='text'] { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; margin-top:0.5rem; font-size:1rem; }
  button { width:100%; padding:10px; margin-top:2rem; background:#667eea; border:none; color:#fff; font-size:1.2rem; border-radius:10px; cursor:pointer; }
  .error { background:#fed7d7; color:#c53030; padding:10px; border-radius:6px; margin-bottom:15px; text-align:center; }
</style>
</head>
<body>
  <div class="form-container">
    <h2>Mark Your Attendance</h2>
    <form method="post" novalidate>
      <label for="roll_no">Roll Number</label>
      <input type="text" name="roll_no" id="roll_no" required autocomplete="off" placeholder="Enter your roll number" />
      
      <button type="submit" style="margin-top: 20px;">Mark Attendance</button>
    </form>
  </div>

<script>
  const locationErrorDiv = document.getElementById('locationError');
  const form = document.querySelector('form');
  let watchId;
  
  form.onsubmit = function(e) {
    if (!document.getElementById('lat').value || !document.getElementById('lon').value) {
      e.preventDefault();
      locationErrorDiv.style.display = 'block';
      locationErrorDiv.textContent = "Please wait for location to be detected or enable location services.";
      return false;
    }
  };

  if (navigator.geolocation) {
    const locationOptions = {
      enableHighAccuracy: true,
      timeout: 5000,
      maximumAge: 0
    };

    watchId = navigator.geolocation.watchPosition(
      position => {
        if (position.coords.accuracy > 100) { // If accuracy is worse than 100 meters
          locationErrorDiv.style.display = 'block';
          locationErrorDiv.textContent = "Waiting for better location accuracy...";
          document.getElementById('lat').value = '';
          document.getElementById('lon').value = '';
          return;
        }
        document.getElementById('lat').value = position.coords.latitude.toFixed(6);
        document.getElementById('lon').value = position.coords.longitude.toFixed(6);
        locationErrorDiv.style.display = 'none';
      },
      error => {
        locationErrorDiv.style.display = 'block';
        switch(error.code) {
          case error.PERMISSION_DENIED:
            locationErrorDiv.textContent = "Error: Location access denied. Please enable location permissions.";
            break;
          case error.POSITION_UNAVAILABLE:
            locationErrorDiv.textContent = "Error: Location information unavailable.";
            break;
          case error.TIMEOUT:
            locationErrorDiv.textContent = "Error: Location request timed out.";
            break;
          default:
            locationErrorDiv.textContent = "Error: Unknown geolocation error.";
        }
        document.getElementById('lat').placeholder = "Location unavailable";
        document.getElementById('lon').placeholder = "Location unavailable";
      }
    );
  } else {
    locationErrorDiv.style.display = 'block';
    locationErrorDiv.textContent = 'Error: Geolocation is not supported by your browser.';
    document.getElementById('lat').placeholder = "Not supported";
    document.getElementById('lon').placeholder = "Not supported";
  }
</script>
</body>
</html>
